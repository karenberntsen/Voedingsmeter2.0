<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    
    <script>
       window.onload=function(){ beginFunctie();}
    
       function beginFunctie(){
      		getData("getEenheden", maakDropdown,"eenheid");
			getData("getProductgroep", maakDropdown,"productgroep");
			getData("getProductFields",maakInputFields,"")
       }
    
       function getData(api, functieCallback,elementId){
       		var xhttp = new XMLHttpRequest();
    	    xhttp.onreadystatechange = function() {
          		if (this.readyState == 4 && this.status == 200) {
            		functieCallback(this.responseText,elementId);
          		}
        	};
       		xhttp.open("GET", "http://localhost:8080/"+api);
       		xhttp.setRequestHeader("Content-type", "application/json");
        	xhttp.send();
	   }
    
  	   function maakDropdown(dataFromDatabase,elementId){
     		var opties = JSON.parse(dataFromDatabase);
     		for (var i = 0; i < opties.length; i++) {
				var optie = document.createElement("OPTION");
				optie.setAttribute("value", opties[i]);
				optie.appendChild(document.createTextNode(opties[i]));
				document.getElementById(elementId).appendChild(optie);
			}
	    }
  	   
  	   function camelCaseToFirstUpperCase(text) {
  		   return firstToUpperCase(text.replace(/([A-Z])/g, ' $1').toLowerCase());
  	   }
  	   
  	 function firstToUpperCase( str ) {
  	    return str.substr(0, 1).toUpperCase() + str.substr(1);
  	 }
  	   
  	   
  	   function maakInputFields(dataFromDatabase,elementId) {
    		var fields = JSON.parse(dataFromDatabase);
     		for (var i = 0; i < fields.length; i++) {
     			 var field = fields[i];
     			 if (document.getElementById(field)==null && field!="id") {
     				var divje = document.createElement("div");
     				divje.className="form-group";
     				labeltje=document.createElement("label");
     				labeltje.className="control-label col-sm-2";
     				var tekstNaam=field;
     				labeltje.innerHTML=camelCaseToFirstUpperCase(tekstNaam)+":";
     				divje2=document.createElement("div");
     				divje2.className="col-sm-offset-2 col-sm-10";
     				inputje=document.createElement("input");
     				inputje.id=field;
     				inputje.type="number";
     				inputje.step=".1";
     				inputje.className="form-control";
     				divje2.appendChild(inputje);
     				labeltje.appendChild(divje2);
     				divje.appendChild(labeltje);
     				inputForm=document.getElementById("productInputForm");
     				inputForm.insertBefore(divje,document.getElementById("submitDiv"));
     			 }
			}
  	   }
   		
  	 function productVersturen() {
 		var inputs = document.getElementById("productInputForm").getElementsByTagName("input");
		var selects = document.getElementById("productInputForm").getElementsByTagName("select");
		var product  = {}
		for (var i = 0; i < inputs.length; i++) {
			product[inputs[i].id]=inputs[i].value;
		}
		for (var i = 0; i < selects.length; i++) {
			product[selects[i].id]=selects[i].value;
		}
		postData("ProductPost", JSON.stringify(product));
	  	}
  	   
  	   
		function productVersturenOud(){
	    	var productNaam = document.getElementById("naam").value;
	        var hoeveelheid = document.getElementById("hoeveelheid").value;
	        var eenheid = document.getElementById("eenheid").value;
	        var bron = document.getElementById("bron").value;
	        var productgroep = document.getElementById("productgroep").value;
			var product = '{"naam":"'+productNaam+'","hoeveelheid":"'+hoeveelheid+'","eenheid":"'+eenheid+'","productgroep":"'+productgroep+'","bron":"'+bron+'"}'; 
			postData("ProductPost", product);
		}
		
		function postData(api, data){
			var xhttp = new XMLHttpRequest();
	  		xhttp.onreadystatechange = function() {
	    			if (this.readyState == 4 && this.status == 200) {
	      				document.getElementById("resultaat").innerHTML = this.responseText;
	    			} else if (this.readyState == 4 && this.status == 202) {
	    				
	    			}
	  		};
	        xhttp.open("POST", "http://localhost:8080/"+api, true);
			xhttp.setRequestHeader("Content-type", "application/json");
			xhttp.send(data);
		}
		
    </script>
    
  </head>
  <body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
  	<a class="navbar-brand" href="index.html">Voedingsmeter</a>
  	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    	<span class="navbar-toggler-icon"></span>
  	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
    	<ul class="navbar-nav mr-auto">
      		<li class="nav-item active">
        		<a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
      		</li>
      		<li class="nav-item">
        		<a class="nav-link" href="producten.html">Producten toevoegen</a>
      		</li>
      		<li class="nav-item">
        		<a class="nav-link" href="login.html">Log in</a>
      		</li>
      		<li class="nav-item">
        		<a class="nav-link disabled" href="#">Disabled</a>
      		</li>
    	</ul>
  	</div>
	</nav>

	<div class="container">
  		<h2>Voeg product toe aan de database</h2>
  	<div id="resultaat"></div>
  	<form class="form-horizontal" id="productInputForm">
    	<div class="form-group">
      		<label class="control-label col-sm-2">Product:</label>
      		<div class="col-sm-10">
        		<input id="naam" type="text" class="form-control" id="naam" placeholder="Productnaam" required/>
      		</div>
   		</div>
    	<div class="form-group">
      		<label class="control-label col-sm-2">Hoeveelheid:</label>
      		<div class="col-sm-10">          
        		<input id="hoeveelheid" type="number" class="form-control" placeholder="100" required/>
        		Eenheid:
        		<select class="selectpicker" id="eenheid" required>
				</select>
      		</div>
    	</div>
    	<div class="form-group">
      		<label class="control-label col-sm-2">Productgroep:</label>
      		<div class="col-sm-10">          
        		<select class="selectpicker" id="productgroep" required>
				</select>
      		</div>
   		</div>
    	<div class="form-group">
      		<label class="control-label col-sm-2">Bron:</label>
      		<div class="col-sm-10">          
    	    	<input id="bron" type="text" class="form-control"/ required>
      		</div>
    	</div>
    	<div class="form-group" id="submitDiv">        
      		<div class="col-sm-offset-2 col-sm-10">
        		<button type="submit" class="btn btn-default" onclick="productVersturen()">Voeg toe</button>
      		</div>
    	</div>
  </form>
</div>



<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  </body>
</html>